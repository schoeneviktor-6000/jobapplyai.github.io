<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>jobmejob • Plan</title>
<style>
:root{
--bg:#ffffff;
--surface:#f6f7f8;
--surface2:#f0f2f3;
--text:#0b0b0b;
--muted:#3f3f3f;
--muted2:#6a6a6a;
--border:rgba(0,0,0,.12);
--shadow:0 16px 42px rgba(0,0,0,.10);
--radius:18px;
--max:1120px;

/* Green CI (no blue) */
--accent:#22c55e;
--accent2:#16a34a;

--ok:#0a3a1c;
--warn:#5a3b00;
--bad:#5a1130;

--safeTop: env(safe-area-inset-top, 0px);
--safeBottom: env(safe-area-inset-bottom, 0px);
}
*{box-sizing:border-box}
html,body{height:100%}
body{
margin:0;
font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
color:var(--text);
background:
radial-gradient(1200px 650px at 20% -10%, rgba(34,197,94,.14), transparent 55%),
radial-gradient(900px 500px at 90% 10%, rgba(22,163,74,.12), transparent 55%),
var(--bg);
overflow-x:hidden;
}
a{color:inherit;text-decoration:none}
.topbar{
position:sticky;
top:0;
z-index:30;
background:rgba(255,255,255,.86);
backdrop-filter:saturate(1.2) blur(12px);
border-bottom:1px solid var(--border);
padding-top:var(--safeTop);
}
.nav{
max-width:var(--max);
margin:0 auto;
padding:12px 16px;
display:flex;
align-items:center;
justify-content:space-between;
gap:12px;
}
.brand{
display:flex;
align-items:center;
gap:10px;
font-weight:1000;
letter-spacing:.2px;
min-width:0;
}
.logo{
width:34px;height:34px;border-radius:11px;
background: linear-gradient(135deg, var(--accent), var(--accent2));
box-shadow: 0 10px 30px rgba(34,197,94,.18);
flex:0 0 auto;
position:relative;
overflow:hidden;
}
.logo::after{
content:"";
position:absolute;
inset:-45%;
background:linear-gradient(90deg, transparent, rgba(255,255,255,.75), transparent);
transform:rotate(20deg);
animation:shine 2.8s ease-in-out infinite;
}
@keyframes shine{
0%{transform:translateX(-55%) rotate(20deg);opacity:0}
35%{opacity:1}
70%{opacity:0}
100%{transform:translateX(55%) rotate(20deg);opacity:0}
}
.navlinks{
display:flex;
align-items:center;
gap:10px;
flex-wrap:wrap;
justify-content:flex-end;
}
.pill{
padding:9px 12px;
border:1px solid var(--border);
border-radius:999px;
background:rgba(0,0,0,.03);
font-weight:900;
font-size:13px;
transition:.15s ease;
cursor:pointer;
white-space:nowrap;
}
.pill:hover{transform:translateY(-1px);background:rgba(0,0,0,.05)}
.pill.active{border-color:rgba(34,197,94,.55); background:rgba(34,197,94,.12)}
.pill.iconOnly{padding:9px 10px}

.main{
max-width:var(--max);
margin:0 auto;
padding:18px 16px calc(18px + var(--safeBottom));
}
.h1{
font-size:34px;
line-height:1.05;
letter-spacing:-.8px;
margin:10px 0 8px 0;
}
.sub{margin:0 0 14px 0;color:var(--muted);font-weight:650}
.small{font-size:12px;color:var(--muted2);font-weight:650}

.errorTop{
margin:12px 0 12px 0;
padding:12px 14px;
border-radius:16px;
border:1px solid rgba(255,61,113,.25);
background:rgba(255,61,113,.10);
color:var(--bad);
font-weight:900;
display:none;
}

.section{
background:linear-gradient(180deg, rgba(255,255,255,.92), rgba(255,255,255,.82));
border:1px solid var(--border);
border-radius:var(--radius);
box-shadow:var(--shadow);
padding:14px;
overflow:hidden;
}
.sectionHead{
display:flex;
align-items:flex-start;
justify-content:space-between;
gap:14px;
flex-wrap:wrap;
}
.badge{
display:inline-flex;
align-items:center;
gap:8px;
padding:7px 10px;
border-radius:999px;
border:1px solid var(--border);
background:rgba(0,0,0,.03);
color:var(--muted);
font-size:12px;
font-weight:900;
white-space:nowrap;
}
.badge.good{border-color:rgba(34,197,94,.40); background:rgba(34,197,94,.12); color:var(--ok)}
.badge.warn{border-color:rgba(255,179,0,.45); background:rgba(255,179,0,.10); color:var(--warn)}
.badge.prio{border-color:rgba(34,197,94,.45); background:rgba(34,197,94,.12); color:#0a3d1f}

.pricingWrap{
display:grid;
grid-template-columns:repeat(3,1fr);
gap:14px;
margin-top:14px;
}
@media (max-width:980px){
.pricingWrap{grid-template-columns:1fr}
}
.card{
background:#fff;
border:1px solid var(--border);
border-radius:18px;
padding:16px;
box-shadow:0 12px 34px rgba(0,0,0,.08);
position:relative;
overflow:hidden;
}
.card.plan{min-height:360px;display:flex;flex-direction:column}
.card.plan.selected{outline:3px solid rgba(34,197,94,.30); border-color:rgba(34,197,94,.35)}
.card.plan.featured{border-color:rgba(34,197,94,.35); box-shadow:0 18px 46px rgba(34,197,94,.14)}
.ribbon{
position:absolute;
top:14px;
right:-44px;
transform:rotate(30deg);
background:linear-gradient(135deg, rgba(34,197,94,.98), rgba(22,163,74,.98));
color:#fff;
font-weight:1000;
font-size:12px;
padding:8px 60px;
letter-spacing:.2px;
}
.priceRow{
display:flex;
align-items:baseline;
gap:8px;
flex-wrap:wrap;
margin-top:10px;
}
.strike{
text-decoration:line-through;
color:var(--muted2);
font-weight:900;
}
.priceRow strong{font-size:26px;letter-spacing:-.4px}
.save{
display:inline-flex;
align-items:center;
padding:6px 10px;
border-radius:999px;
border:1px solid rgba(0,0,0,.10);
background:rgba(0,0,0,.03);
font-weight:1000;
font-size:12px;
}
.valueRow{
margin-top:12px;
border:1px solid rgba(0,0,0,.10);
background:rgba(0,0,0,.02);
border-radius:16px;
padding:12px;
display:flex;
align-items:center;
justify-content:space-between;
gap:10px;
}
.valueRow strong{display:block}
.valueRow span{display:block;color:var(--muted2);font-size:12px;font-weight:700}
.features{margin:12px 0 0 0;padding:0;list-style:none;display:grid;gap:10px}
.features li{display:flex;gap:10px;align-items:flex-start;color:var(--muted);font-size:14px;font-weight:700}
.tick{
width:18px;height:18px;border-radius:8px;
border:1px solid rgba(0,0,0,.14);
background:rgba(0,0,0,.03);
display:inline-flex;
align-items:center;
justify-content:center;
flex:0 0 auto;
margin-top:1px;
}
.tick svg{width:14px;height:14px}
.planActions{margin-top:auto;padding-top:14px}
.btn{
appearance:none;
border:1px solid var(--border);
background:rgba(0,0,0,.03);
color:var(--text);
padding:11px 14px;
border-radius:999px;
font-weight:1000;
font-size:13px;
cursor:pointer;
transition:.15s ease;
display:inline-flex;
align-items:center;
gap:8px;
text-decoration:none;
width:100%;
justify-content:center;
}
.btn:hover{transform:translateY(-1px); background:rgba(0,0,0,.05)}
.btn:disabled{opacity:.6; cursor:not-allowed; transform:none}
.btn.primary{
border-color:rgba(34,197,94,.55);
background:linear-gradient(135deg, rgba(34,197,94,.22), rgba(22,163,74,.14));
}
.fineprint{
margin:12px 0 0 0;
color:var(--muted2);
font-size:12px;
font-weight:650;
line-height:1.45;
}
.leaving{opacity:.7;transform:translateY(6px);transition:all .18s ease}
</style>
</head>
<body>
<header class="topbar">
<nav class="nav">
<a class="brand" href="index.html" data-nav="1"><span class="logo" aria-hidden="true"></span><span>jobmejob</span></a>
<div class="navlinks">
<a class="pill" href="index.html" data-nav="1">Home</a>
<a class="pill" href="profile.html" data-nav="1">Profile</a>
<a class="pill active" href="plan.html" data-nav="1">Plan</a>
<a class="pill" href="dashboard.html" data-nav="1">Dashboard</a>
<button class="pill iconOnly" id="btnLogout" type="button" aria-label="Logout">Logout</button>
</div>
</nav>
</header>

<main class="main">
<h1 class="h1">Choose a plan</h1>
<p class="sub" id="subLine">Loading…</p>
<div class="errorTop" id="errorTop"></div>

<section class="section">
<div class="sectionHead">
<div>
<div class="badge prio" id="currentPlanBadge">Current plan: —</div>
<div class="small" style="margin-top:8px">Plans map to your daily application output. You can change plans anytime.</div>
</div>
<div class="badge" id="authBadge">Checking…</div>
</div>

<div class="pricingWrap">
<div class="card plan" id="cardStarter">
<h3 style="margin:0 0 6px;font-weight:1000;letter-spacing:-.2px">Starter</h3>
<p style="margin:0;color:var(--muted);font-size:14px;font-weight:700">For steady progress.</p>
<div class="priceRow">
<div class="strike">$29</div>
<strong>$20</strong>
<span style="color:var(--muted);font-weight:800">/ month</span>
<span class="save">Save 31%</span>
</div>
<div class="valueRow" aria-label="Monthly value">
<div>
<strong>1 application / day</strong>
<span>≈ 30 per month</span>
</div>
<div class="badge" id="badgeStarter">starter</div>
</div>
<ul class="features">
<li><span class="tick" aria-hidden="true"><svg viewBox="0 0 24 24" fill="none"><path d="M20 6 9 17l-5-5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></span>Manual email application</li>
<li><span class="tick" aria-hidden="true"><svg viewBox="0 0 24 24" fill="none"><path d="M20 6 9 17l-5-5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></span>Basic application log</li>
<li><span class="tick" aria-hidden="true"><svg viewBox="0 0 24 24" fill="none"><path d="M20 6 9 17l-5-5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></span>CV upload + OCR</li>
</ul>
<div class="planActions">
<button class="btn primary" id="btnStarter" type="button">Select Starter</button>
</div>
</div>

<div class="card plan featured" id="cardPro" aria-label="Best value plan">
<div class="ribbon">Best value</div>
<h3 style="margin:0 0 6px;font-weight:1000;letter-spacing:-.2px">Growth</h3>
<p style="margin:0;color:var(--muted);font-size:14px;font-weight:700">For active searches.</p>
<div class="priceRow">
<div class="strike">$69</div>
<strong>$45</strong>
<span style="color:var(--muted);font-weight:800">/ month</span>
<span class="save">Save 35%</span>
</div>
<div class="valueRow" aria-label="Monthly value">
<div>
<strong>5 applications / day</strong>
<span>≈ 150 per month</span>
</div>
<div class="badge" id="badgePro">pro</div>
</div>
<ul class="features">
<li><span class="tick" aria-hidden="true"><svg viewBox="0 0 24 24" fill="none"><path d="M20 6 9 17l-5-5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></span>Priority turnaround</li>
<li><span class="tick" aria-hidden="true"><svg viewBox="0 0 24 24" fill="none"><path d="M20 6 9 17l-5-5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></span>Better tracking view</li>
<li><span class="tick" aria-hidden="true"><svg viewBox="0 0 24 24" fill="none"><path d="M20 6 9 17l-5-5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></span>Follow-up templates</li>
</ul>
<div class="planActions">
<button class="btn primary" id="btnPro" type="button">Select Growth</button>
</div>
</div>

<div class="card plan" id="cardMax">
<h3 style="margin:0 0 6px;font-weight:1000;letter-spacing:-.2px">Max</h3>
<p style="margin:0;color:var(--muted);font-size:14px;font-weight:700">For high volume.</p>
<div class="priceRow">
<div class="strike">$129</div>
<strong>$79</strong>
<span style="color:var(--muted);font-weight:800">/ month</span>
<span class="save">Save 39%</span>
</div>
<div class="valueRow" aria-label="Monthly value">
<div>
<strong>10 applications / day</strong>
<span>≈ 300 per month</span>
</div>
<div class="badge" id="badgeMax">max</div>
</div>
<ul class="features">
<li><span class="tick" aria-hidden="true"><svg viewBox="0 0 24 24" fill="none"><path d="M20 6 9 17l-5-5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></span>Highest throughput</li>
<li><span class="tick" aria-hidden="true"><svg viewBox="0 0 24 24" fill="none"><path d="M20 6 9 17l-5-5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></span>Best response coverage</li>
<li><span class="tick" aria-hidden="true"><svg viewBox="0 0 24 24" fill="none"><path d="M20 6 9 17l-5-5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></span>Enhanced reporting</li>
</ul>
<div class="planActions">
<button class="btn primary" id="btnMax" type="button">Select Max</button>
</div>
</div>
</div>

<p class="fineprint">Monthly totals are approximate (30-day month). Prices are promotional and may change after launch.</p>
</section>
</main>

<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<script>
"use strict";

const API_BASE="https://https://jobmejob.schoene-viktor.workers.dev";

const SUPABASE_URL_DEFAULT="https://awlzvhcnjegfhjedswko.supabase.co";
const SUPABASE_ANON_FALLBACK="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImF3bHp2aGNuamVnZmhqZWRzd2tvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY2NTE2OTgsImV4cCI6MjA4MjIyNzY5OH0.-UmHiVi0_g9tKDkr6ldfROeBrOk8hm18YVPRfnb8luY";

if(!localStorage.getItem("sb_url")) localStorage.setItem("sb_url",SUPABASE_URL_DEFAULT);
if(!localStorage.getItem("sb_anon")) localStorage.setItem("sb_anon",SUPABASE_ANON_FALLBACK);

const SUPABASE_URL=localStorage.getItem("sb_url")||SUPABASE_URL_DEFAULT;
const SUPABASE_ANON_KEY=localStorage.getItem("sb_anon")||SUPABASE_ANON_FALLBACK;

let supabaseClient=null;
let session=null;
let state=null;

function $(id){return document.getElementById(id);}
function showTopError(msg){const el=$("errorTop");if(!el) return;el.style.display="block";el.textContent=msg;}
function clearTopError(){const el=$("errorTop");if(!el) return;el.style.display="none";el.textContent="";}
function setBadge(id,cls,text){const el=$(id);if(!el) return;el.className="badge"+(cls?(" "+cls):"");el.textContent=text;}
function setText(id,text){const el=$(id);if(!el) return;el.textContent=text;}

function go(url){
document.body.classList.add("leaving");
setTimeout(()=>{window.location.href=url;},180);
}
document.addEventListener("click",(e)=>{
const a=e.target.closest("a[data-nav='1']");
if(!a) return;
const url=a.getAttribute("href");
if(!url || url.startsWith("#")) return;
e.preventDefault();
go(url);
});

async function apiGet(path){
const res=await fetch(API_BASE+path,{method:"GET",headers:{Authorization:"Bearer "+session.access_token}});
const txt=await res.text().catch(()=> "");
let json=null;
try{json=JSON.parse(txt);}catch{json={raw:txt};}
if(!res.ok) throw new Error(path+" failed: "+res.status+" "+(json.error||json.details||txt));
return json;
}
async function apiPostJson(path,body){
const res=await fetch(API_BASE+path,{
method:"POST",
headers:{Authorization:"Bearer "+session.access_token,"content-type":"application/json"},
body:JSON.stringify(body||{})
});
const txt=await res.text().catch(()=> "");
let json=null;
try{json=JSON.parse(txt);}catch{json={raw:txt};}
if(!res.ok) throw new Error(path+" failed: "+res.status+" "+(json.error||json.details||txt));
return json;
}
async function ensureCustomer(email){
const res=await fetch(API_BASE+"/customers/upsert",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({email})});
const txt=await res.text().catch(()=> "");
if(!res.ok) throw new Error("customers/upsert failed: "+res.status+" "+txt);
return JSON.parse(txt);
}

function applySelectionUI(planId){
const ids=["starter","pro","max"];
for(const id of ids){
const card=$("card"+id.charAt(0).toUpperCase()+id.slice(1));
if(card) card.classList.toggle("selected", id===planId);
}
let label="—";
if(planId==="starter") label="Starter (1/day)";
if(planId==="pro") label="Growth (5/day)";
if(planId==="max") label="Max (10/day)";
setText("currentPlanBadge","Current plan: "+label);
}

async function refreshStateAndPlan(){
state=await apiGet("/me/state");
const planId=(state && state.plan_id ? String(state.plan_id).toLowerCase() : "");
applySelectionUI(planId||"");
}

async function selectPlan(planId){
clearTopError();
setBadge("authBadge","warn","Saving…");
$("btnStarter").disabled=true;
$("btnPro").disabled=true;
$("btnMax").disabled=true;
try{
await apiPostJson("/me/plan",{plan_id:planId});
await refreshStateAndPlan();
setBadge("authBadge","good","Saved");
const profOk=!!(state && state.profile_complete);
window.location.href=profOk ? "./dashboard.html" : "./profile.html";
}catch(e){
showTopError(e.message||String(e));
setBadge("authBadge","bad","Failed");
}finally{
$("btnStarter").disabled=false;
$("btnPro").disabled=false;
$("btnMax").disabled=false;
}
}

async function boot(){
try{
clearTopError();
setText("subLine","Checking session…");
supabaseClient=window.supabase.createClient(SUPABASE_URL,SUPABASE_ANON_KEY);
const s=await supabaseClient.auth.getSession();
session=s && s.data ? s.data.session : null;
if(!session || !session.user || !session.user.email){
window.location.replace("./signup.html");
return;
}
const email=String(session.user.email||"").trim().toLowerCase();
setText("subLine","Signed in as "+email);
setBadge("authBadge","good","Signed in");

await ensureCustomer(email);
await refreshStateAndPlan();

$("btnStarter").addEventListener("click",()=>selectPlan("starter"));
$("btnPro").addEventListener("click",()=>selectPlan("pro"));
$("btnMax").addEventListener("click",()=>selectPlan("max"));

$("btnLogout").addEventListener("click",async ()=>{
try{
await supabaseClient.auth.signOut();
Object.keys(localStorage).forEach(k=>{
if(k.startsWith("ja_") || k.startsWith("jobapplyai_") || k.startsWith("jm_") || k.startsWith("jobmejob_") || k.startsWith("sb-")){
localStorage.removeItem(k);
}
});
try{sessionStorage.removeItem("sb_access_token");}catch{}
window.location.replace("./index.html");
}catch(e){
showTopError(e.message||String(e));
}
});
}catch(e){
showTopError(e.message||String(e));
setBadge("authBadge","bad","Auth error");
}
}

window.addEventListener("load",boot);
</script>
</body>
</html>
