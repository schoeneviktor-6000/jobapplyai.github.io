<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>JobApplyAI â€¢ Plan</title>
<style>
:root{
--bg:#0b1020;
--card:rgba(255,255,255,.08);
--card2:rgba(255,255,255,.06);
--text:#e9ecf7;
--muted:rgba(233,236,247,.72);
--line:rgba(255,255,255,.12);
--accent:#7c5cff;
--accent2:#00d4ff;
--danger:#ff3d71;
--ok:#00c853;
--warn:#ffb300;
--shadow:0 12px 34px rgba(0,0,0,.35);
}
*{box-sizing:border-box}
html,body{height:100%}
body{
margin:0;
font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
color:var(--text);
background:
radial-gradient(1200px 650px at 20% -10%, rgba(124,92,255,.35), transparent 55%),
radial-gradient(900px 500px at 90% 10%, rgba(0,212,255,.22), transparent 55%),
radial-gradient(800px 600px at 70% 110%, rgba(0,200,83,.10), transparent 55%),
var(--bg);
overflow-x:hidden;
}
a{color:inherit;text-decoration:none}
.wrap{max-width:980px;margin:0 auto;padding:22px 16px 70px}
.topbar{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:18px}
.brand{display:flex;align-items:center;gap:10px;font-weight:800;letter-spacing:.2px}
.logo{width:34px;height:34px;border-radius:11px;background:linear-gradient(135deg,var(--accent),var(--accent2));box-shadow:0 10px 30px rgba(124,92,255,.25)}
.nav{display:flex;gap:10px;flex-wrap:wrap}
.pill{
padding:9px 12px;
border:1px solid var(--line);
border-radius:999px;
background:rgba(255,255,255,.04);
font-weight:650;
font-size:13px;
transition:.15s ease;
}
.pill:hover{transform:translateY(-1px);background:rgba(255,255,255,.06)}
.pill.active{border-color:rgba(124,92,255,.6);background:rgba(124,92,255,.18)}
.card{
background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.05));
border:1px solid var(--line);
border-radius:18px;
box-shadow:var(--shadow);
overflow:hidden;
}
.cardHeader{
padding:18px 18px 14px;
border-bottom:1px solid var(--line);
display:flex;
justify-content:space-between;
align-items:flex-start;
gap:10px;
}
.hTitle{font-size:18px;font-weight:850;margin:0}
.hSub{margin:6px 0 0;color:var(--muted);font-size:13px;line-height:1.35}
.badge{
display:inline-flex;
align-items:center;
gap:8px;
padding:7px 10px;
border-radius:999px;
border:1px solid var(--line);
background:rgba(255,255,255,.05);
color:var(--muted);
font-size:12px;
font-weight:750;
white-space:nowrap;
}
.badge.good{border-color:rgba(0,200,83,.4);background:rgba(0,200,83,.12);color:#c9ffe0}
.badge.warn{border-color:rgba(255,179,0,.5);background:rgba(255,179,0,.12);color:#fff3c4}
.badge.bad{border-color:rgba(255,61,113,.55);background:rgba(255,61,113,.12);color:#ffd1dc}
.grid{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:14px;padding:18px}
.plan{
border:1px solid rgba(255,255,255,.12);
background:rgba(255,255,255,.04);
border-radius:16px;
padding:16px;
transition:.15s ease;
cursor:pointer;
min-height:240px;
display:flex;
flex-direction:column;
gap:10px;
}
.plan:hover{transform:translateY(-2px);background:rgba(255,255,255,.06)}
.plan.active{border-color:rgba(124,92,255,.65);box-shadow:0 0 0 3px rgba(124,92,255,.16)}
.planName{font-size:15px;font-weight:900}
.planCap{font-size:28px;font-weight:950;letter-spacing:.3px}
.planCap small{font-size:12px;color:var(--muted);font-weight:800}
.list{margin:0;padding-left:18px;color:var(--muted);font-size:13px;line-height:1.45}
.actions{
padding:0 18px 18px;
display:flex;
justify-content:space-between;
align-items:center;
gap:10px;
flex-wrap:wrap;
border-top:1px solid var(--line);
}
.btn{
appearance:none;
border:1px solid var(--line);
background:rgba(255,255,255,.06);
color:var(--text);
padding:11px 14px;
border-radius:12px;
font-weight:850;
cursor:pointer;
transition:.15s ease;
display:inline-flex;
align-items:center;
gap:10px;
}
.btn:hover{transform:translateY(-1px);background:rgba(255,255,255,.08)}
.btn:disabled{opacity:.6;cursor:not-allowed;transform:none}
.btn.primary{
border-color:rgba(124,92,255,.55);
background:linear-gradient(135deg, rgba(124,92,255,.30), rgba(0,212,255,.18));
}
.hint{padding:14px 18px 0;color:var(--muted);font-size:12px;line-height:1.4}
.leaving{opacity:.45;filter:blur(.3px);transition:.2s}
@media(max-width:900px){.grid{grid-template-columns:1fr}}
</style>
</head>
<body>
<div class="wrap">
<div class="topbar">
<div class="brand">
<div class="logo"></div>
<div>
<div style="font-size:14px;opacity:.85">JobApplyAI</div>
<div style="font-size:12px;color:var(--muted);font-weight:700">Choose your plan</div>
</div>
</div>
<div class="nav">
<a class="pill" href="./index.html" data-nav="1">Home</a>
<a class="pill" href="./profile.html" data-nav="1">Profile</a>
<a class="pill active" href="./plan.html" data-nav="1">Plan</a>
<a class="pill" href="./dashboard.html" data-nav="1">Dashboard</a>
</div>
</div>

<section class="card">
<div class="cardHeader">
<div>
<h2 class="hTitle">Pick a daily application cap</h2>
<p class="hSub">Payments are not connected yet. This only sets your plan in the database.</p>
</div>
<span class="badge" id="saveStatus">Not saved</span>
</div>

<div class="hint">
Your plan controls how many applications we can send per day. You can change this later.
</div>

<div class="grid" id="planGrid">
<div class="plan" data-plan="starter" role="button" tabindex="0">
<div class="planName">Starter</div>
<div class="planCap">1 <small>/ day</small></div>
<ul class="list">
<li>Best for careful targeting</li>
<li>Manual review before sending (later)</li>
<li>Basic tracking</li>
</ul>
</div>

<div class="plan" data-plan="pro" role="button" tabindex="0">
<div class="planName">Pro</div>
<div class="planCap">5 <small>/ day</small></div>
<ul class="list">
<li>Balanced speed + quality</li>
<li>Priority queue handling (later)</li>
<li>Better matching signals</li>
</ul>
</div>

<div class="plan" data-plan="max" role="button" tabindex="0">
<div class="planName">Max</div>
<div class="planCap">10 <small>/ day</small></div>
<ul class="list">
<li>Fastest ramp-up</li>
<li>Autopilot rules (later)</li>
<li>Follow-ups (later)</li>
</ul>
</div>
</div>

<div class="actions">
<button class="btn" id="backBtn" type="button">Back to profile</button>
<div style="display:flex;gap:10px;flex-wrap:wrap">
<button class="btn primary" id="saveBtn" type="button">Save plan</button>
<button class="btn" id="nextBtn" type="button">Continue to dashboard</button>
</div>
</div>
</section>
</div>

<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<script>
"use strict";

const API_BASE_DEFAULT="https://jobapplyai-api.schoene-viktor.workers.dev";
const API_BASE=API_BASE_DEFAULT.replace(/\/+$/,"");
const SUPABASE_URL_DEFAULT="https://awlzvhcnjegfhjedswko.supabase.co";
const SUPABASE_ANON_DEFAULT=localStorage.getItem("sb_anon")||"";
if(!localStorage.getItem("sb_url")) localStorage.setItem("sb_url",SUPABASE_URL_DEFAULT);
if(!localStorage.getItem("sb_anon") && SUPABASE_ANON_DEFAULT) localStorage.setItem("sb_anon",SUPABASE_ANON_DEFAULT);
const SUPABASE_URL=localStorage.getItem("sb_url")||SUPABASE_URL_DEFAULT;
const SUPABASE_ANON_KEY=localStorage.getItem("sb_anon")||SUPABASE_ANON_DEFAULT;

let supabaseClient=null;
let selectedPlan=(localStorage.getItem("ja_plan")||"").trim().toLowerCase();

function $(id){return document.getElementById(id);}
function go(url){document.body.classList.add("leaving");setTimeout(()=>{window.location.href=url;},180);}

function setStatus(kind,text){
const el=$("saveStatus");
if(!el) return;
el.className="badge"+(kind?(" "+kind):"");
el.textContent=text;
}

function renderActive(){
const cards=[...document.querySelectorAll(".plan[data-plan]")];
for(const c of cards){
const p=(c.getAttribute("data-plan")||"").trim().toLowerCase();
if(p===selectedPlan) c.classList.add("active");
else c.classList.remove("active");
}
}

async function getSession(){
const { data } = await supabaseClient.auth.getSession();
return data && data.session ? data.session : null;
}

async function savePlanToBackend(session, plan_id){
const token=session && session.access_token ? session.access_token : "";
if(!token) throw new Error("Missing access token. Please sign in again.");
const res=await fetch(`${API_BASE}/me/plan`,{
method:"POST",
headers:{
"content-type":"application/json",
"Authorization":`Bearer ${token}`
},
body:JSON.stringify({ plan_id })
});
const text=await res.text().catch(()=> "");
if(!res.ok) throw new Error(`Plan save failed: ${res.status} ${text}`);
return JSON.parse(text);
}

async function loadPlanFromBackend(session){
try{
const token=session && session.access_token ? session.access_token : "";
if(!token) return null;
const res=await fetch(`${API_BASE}/me/plan`,{
method:"GET",
headers:{ "Authorization":`Bearer ${token}` }
});
if(!res.ok) return null;
const data=await res.json();
const plan=data && data.plan && data.plan.plan_id ? String(data.plan.plan_id).trim().toLowerCase() : "";
return plan || null;
}catch{
return null;
}
}

function attachPlanClicks(){
const cards=[...document.querySelectorAll(".plan[data-plan]")];
for(const card of cards){
const pick=()=>{
selectedPlan=(card.getAttribute("data-plan")||"").trim().toLowerCase();
localStorage.setItem("ja_plan",selectedPlan);
renderActive();
setStatus("warn","Not saved");
};
card.addEventListener("click",pick);
card.addEventListener("keydown",(e)=>{if(e.key==="Enter"||e.key===" "){e.preventDefault();pick();}});
}
}

(async function boot(){
try{
if(!SUPABASE_URL || !SUPABASE_ANON_KEY){
setStatus("bad","Missing Supabase config");
return;
}
supabaseClient=window.supabase.createClient(SUPABASE_URL,SUPABASE_ANON_KEY);

document.addEventListener("click",(e)=>{
const a=e.target.closest("a[data-nav='1']");
if(!a) return;
const url=a.getAttribute("href");
if(!url||url.startsWith("#")) return;
e.preventDefault();
go(url);
});

attachPlanClicks();

const session=await getSession();
if(!session || !session.user || !session.user.email){
window.location.replace("./signup.html");
return;
}

const backendPlan=await loadPlanFromBackend(session);
if(backendPlan){
selectedPlan=backendPlan;
localStorage.setItem("ja_plan",selectedPlan);
}

if(!selectedPlan){
selectedPlan="starter";
localStorage.setItem("ja_plan",selectedPlan);
}
renderActive();

$("backBtn").addEventListener("click",()=>go("./profile.html"));
$("nextBtn").addEventListener("click",()=>go("./dashboard.html"));

$("saveBtn").addEventListener("click",async ()=>{
if(!selectedPlan){
setStatus("bad","Pick a plan first");
return;
}
$("saveBtn").disabled=true;
setStatus("warn","Saving...");
try{
await savePlanToBackend(session,selectedPlan);
setStatus("good","Saved");
}catch(e){
setStatus("bad","Save failed");
alert(e && e.message ? e.message : String(e));
}finally{
$("saveBtn").disabled=false;
}
});

setStatus(selectedPlan ? "warn" : "", selectedPlan ? "Not saved" : "Pick a plan");
}catch(e){
setStatus("bad","Error");
alert(e && e.message ? e.message : String(e));
}
})();
</script>
</body>
</html>
