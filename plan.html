<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
<title>jobmejob • Plan</title>
<link rel="stylesheet" href="./styles.css">
<style>
.pricingWrap{display:grid;grid-template-columns:repeat(3,1fr);gap:14px;margin-top:14px}
@media (max-width:980px){.pricingWrap{grid-template-columns:1fr}}
.planCard{background:#fff;border:1px solid rgba(17,19,24,.12);border-radius:18px;padding:16px;box-shadow:0 12px 34px rgba(0,0,0,.08)}
.planCard.selected{outline:3px solid rgba(34,197,94,.30);border-color:rgba(34,197,94,.35)}
.price{font-size:26px;font-weight:950}
</style>
</head>

<body>
<header class="topbar">
<nav class="nav">
<a class="brand" href="index.html"><span class="logo" aria-hidden="true"></span><span>jobmejob</span></a>
<div class="navlinks">
<a class="pill" href="index.html">Home</a>
<a class="pill" href="profile.html">Profile</a>
<a class="pill active" href="plan.html">Plan</a>
<a class="pill" href="dashboard.html">Dashboard</a>
<button class="pill iconOnly" id="btnLogout" type="button">Logout</button>
</div>
</nav>
</header>

<main class="main">
<h1 class="h1">Choose a plan</h1>
<p class="sub" id="subLine">Loading…</p>
<div class="errorTop" id="errorTop"></div>

<section class="card">
<div style="display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap">
<span class="badge prio" id="currentPlan">Current plan: —</span>
<span class="badge" id="authBadge">Checking…</span>
</div>

<div class="pricingWrap">
<div class="planCard" id="starterCard">
<div style="font-weight:950">Starter</div>
<div class="small">1 application/day</div>
<div class="hr"></div>
<div class="price">$20 <span class="small">/month</span></div>
<div class="hr"></div>
<button class="btn primary" id="btnStarter" type="button">Select Starter</button>
</div>

<div class="planCard" id="proCard">
<div style="font-weight:950">Growth</div>
<div class="small">5 applications/day</div>
<div class="hr"></div>
<div class="price">$45 <span class="small">/month</span></div>
<div class="hr"></div>
<button class="btn cta" id="btnPro" type="button">Select Growth</button>
</div>

<div class="planCard" id="maxCard">
<div style="font-weight:950">Max</div>
<div class="small">10 applications/day</div>
<div class="hr"></div>
<div class="price">$79 <span class="small">/month</span></div>
<div class="hr"></div>
<button class="btn primary" id="btnMax" type="button">Select Max</button>
</div>
</div>

<div class="small" style="margin-top:12px">You can change your plan anytime.</div>
</section>
</main>

<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<script src="./config.js"></script>
<script src="./app.js"></script>
<script>
"use strict";
const { requireSession, logout, ensureCustomer, apiPostJson, getState } = window.JobMeJob.app;

let session=null;

function showErr(msg){
const el=document.getElementById("errorTop");
el.style.display = msg ? "block" : "none";
el.textContent = msg || "";
}
function setBadge(id, cls, text){
const el=document.getElementById(id);
el.className="badge"+(cls?(" "+cls):"");
el.textContent=text;
}
function applyUI(plan){
document.getElementById("starterCard").classList.toggle("selected", plan==="starter");
document.getElementById("proCard").classList.toggle("selected", plan==="pro");
document.getElementById("maxCard").classList.toggle("selected", plan==="max");
const map={starter:"Starter (1/day)",pro:"Growth (5/day)",max:"Max (10/day)"};
document.getElementById("currentPlan").textContent="Current plan: " + (map[plan]||"—");
}

async function refresh(){
const st=await getState(session.access_token);
applyUI(String(st?.plan_id||"").toLowerCase());
}

async function select(planId){
showErr("");
setBadge("authBadge","warn","Saving…");
try{
await apiPostJson("/me/plan", session.access_token, { plan_id: planId });
await refresh();
setBadge("authBadge","good","Saved");
const st=await getState(session.access_token);
window.location.href = (st?.profile_complete ? "./dashboard.html" : "./profile.html");
}catch(e){
setBadge("authBadge","bad","Failed");
showErr(e.message||String(e));
}
}

async function boot(){
try{
session = await requireSession("./signup.html");
if(!session) return;
const email=String(session.user.email||"").trim().toLowerCase();
document.getElementById("subLine").textContent="Signed in as "+email;
await ensureCustomer(email);
await refresh();
setBadge("authBadge","good","Signed in");

document.getElementById("btnStarter").onclick=()=>select("starter");
document.getElementById("btnPro").onclick=()=>select("pro");
document.getElementById("btnMax").onclick=()=>select("max");
document.getElementById("btnLogout").onclick=()=>logout("./index.html");
}catch(e){
showErr(e.message||String(e));
setBadge("authBadge","bad","Auth error");
}
}
window.addEventListener("load", boot);
</script>
</body>
</html>
