<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Home · jobmejob</title>
  <meta name="description" content="jobmejob helps you search jobs, tailor your CV, and (with a plan) auto-apply." />

  <style>
    :root{
      --bg: #f6f7fb;
      --card: rgba(255,255,255,0.92);
      --text: #0f172a;
      --muted:#5b6474;
      --muted2:#7a8394;
      --border: rgba(15, 23, 42, 0.12);
      --shadow: 0 18px 60px rgba(15, 23, 42, 0.10);
      --shadow2: 0 10px 24px rgba(15, 23, 42, 0.08);
      --good: #16a34a;
      --warn: #b45309;
      --bad:  #b42318;
      --radius: 18px;
      --max: 1100px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      color:var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      background:
        radial-gradient(900px 300px at 20% 0%, rgba(34,197,94,.14), transparent 55%),
        radial-gradient(900px 320px at 90% 10%, rgba(56,189,248,.10), transparent 55%),
        linear-gradient(180deg, var(--bg), #fff 60%, var(--bg));
    }
    a{color:inherit}
    .leaving{opacity:.7; transform:translateY(6px); transition:all .18s ease}

    /* Top bar (consistent with multipage app) */
    .topbar{
      position:sticky; top:0; z-index:30;
      background:rgba(246,247,251,86);
      backdrop-filter:saturate(1.2) blur(12px);
      border-bottom:1px solid rgba(15,23,42,.10);
      padding-top: env(safe-area-inset-top, 0px);
    }
    .nav{
      max-width:var(--max);
      margin:0 auto;
      padding:12px 16px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }
    .brand{
      display:flex;
      align-items:center;
      gap:10px;
      font-weight:950;
      letter-spacing:.2px;
      text-decoration:none;
      min-width:0;
    }
    .logo{
      width:34px;height:34px;border-radius:11px;
      background: linear-gradient(135deg, rgba(34,197,94,.92), rgba(56,189,248,.70));
      box-shadow: 0 10px 30px rgba(34,197,94,22);
      flex:0 0 auto;
      position:relative;
      overflow:hidden;
    }
    .logo::after{
      content:"";
      position:absolute;
      inset:-45%;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.55), transparent 40%);
      transform: rotate(20deg);
    }
    .navlinks{
      display:flex;
      align-items:center;
      gap:8px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }
    .pill{
      appearance:none;
      border:1px solid rgba(15,23,42,.10);
      background: rgba(255,255,255,.70);
      color:var(--text);
      padding:9px 12px;
      border-radius:999px;
      font-weight:900;
      font-size:13px;
      cursor:pointer;
      text-decoration:none;
      display:inline-flex;
      align-items:center;
      gap:8px;
      transition:transform .12s ease, box-shadow .18s ease, background .12s ease;
    }
    .pill:hover{
      transform:translateY(-1px);
      box-shadow: 0 14px 30px rgba(15,23,42,.10);
      background:#fff;
    }
    .pill.active{
      border-color: rgba(34,197,94,.55);
      background: linear-gradient(135deg, rgba(34,197,94,.20), rgba(22,163,74,.14));
    }
    .pill.iconOnly{padding:9px 12px}
    .pill:disabled{opacity:.55; cursor:not-allowed; transform:none; box-shadow:none}

    /* Page layout */
    .main{
      max-width:var(--max);
      margin:0 auto;
      padding:22px 16px 54px;
    }
    .hero{
      border:1px solid var(--border);
      background:
        radial-gradient(900px 240px at 10% 0%, rgba(34,197,94,.18), transparent 60%),
        radial-gradient(900px 240px at 95% 10%, rgba(56,189,248,.10), transparent 62%),
        linear-gradient(180deg, rgba(255,255,255,.92), rgba(255,255,255,.86));
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 18px;
      overflow:hidden;
    }
    h1{
      margin:0;
      font-size:38px;
      letter-spacing:-.6px;
      line-height:1.1;
      font-weight:1000;
    }
    .sub{
      margin:10px 0 0;
      color:var(--muted);
      font-weight:750;
      line-height:1.5;
      max-width: 72ch;
    }
    .heroRow{
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap:14px;
      align-items:start;
      margin-top: 14px;
    }
    @media (max-width: 900px){
      h1{font-size:32px}
      .heroRow{grid-template-columns:1fr}
    }

    .card{
      border:1px solid var(--border);
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow2);
      padding: 16px;
    }
    .sectionTitle{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin: 0 0 10px 0;
    }
    .h2{
      margin:0;
      font-size:16px;
      font-weight:1000;
      letter-spacing:-.2px;
    }
    .badge{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:7px 10px;
      border-radius:999px;
      border:1px solid rgba(15,23,42,.14);
      background: rgba(15,23,42,.03);
      font-weight:900;
      font-size:12px;
      color: var(--text);
      white-space:nowrap;
    }
    .badge.good{border-color: rgba(34,197,94,.40); background: rgba(34,197,94,.10); color:#0c4a2a;}
    .badge.warn{border-color: rgba(245,158,11,.38); background: rgba(245,158,11,.10); color:#6b3b00;}
    .badge.bad{border-color: rgba(244,63,94,.32); background: rgba(244,63,94,.08); color:#7a1020;}

    .actions{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top: 12px;
    }
    .btn{
      appearance:none;
      border:1px solid rgba(15,23,42,.12);
      background: rgba(255,255,255,.90);
      color:var(--text);
      padding:10px 12px;
      border-radius: 999px;
      font-weight:1000;
      font-size:13px;
      cursor:pointer;
      transition:transform .12s ease, box-shadow .18s ease, background .12s ease;
      display:inline-flex;
      align-items:center;
      gap:8px;
      text-decoration:none;
    }
    .btn:hover{
      transform:translateY(-1px);
      box-shadow:0 14px 30px rgba(15,23,42,.10);
      background:#fff;
    }
    .btn.primary{
      border:0;
      background: linear-gradient(135deg, rgba(34,197,94,.95), rgba(22,163,74,.85));
      color:#04130a;
      box-shadow:0 14px 30px rgba(34,197,94,.18);
    }
    .btn.primary:hover{
      box-shadow:0 18px 42px rgba(34,197,94,.20);
    }
    .btn:disabled{opacity:.6; cursor:not-allowed; transform:none; box-shadow:none}
    .btn.ghost{background:transparent}

    .grid{
      margin-top: 14px;
      display:grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 12px;
    }
    @media (max-width: 980px){
      .grid{grid-template-columns:1fr}
    }
    .tile{
      border:1px solid rgba(15,23,42,.10);
      background: rgba(255,255,255,.80);
      border-radius: 16px;
      padding: 14px;
      box-shadow: var(--shadow2);
    }
    .tileTitle{
      font-weight:1000;
      margin:0;
      letter-spacing:-.2px;
    }
    .tileSub{
      margin:6px 0 0;
      color:var(--muted2);
      font-weight:750;
      font-size:13px;
      line-height:1.45;
    }
    .tileFooter{
      margin-top:10px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }

    .steps{
      display:grid;
      gap:10px;
      margin-top:10px;
    }
    .step{
      display:flex;
      gap:12px;
      padding:12px 14px;
      border-radius:16px;
      border:1px solid rgba(15,23,42,.10);
      background: rgba(255,255,255,.85);
    }
    .num{
      width:28px;height:28px;border-radius:10px;
      display:grid;place-items:center;
      font-weight:1000;
      background:linear-gradient(135deg, rgba(34,197,94,.20), rgba(22,163,74,.16));
      border:1px solid rgba(15,23,42,.06);
      flex:0 0 auto;
    }
    .stepTitle{font-weight:1000; margin:0}
    .stepDesc{margin:3px 0 0; color:var(--muted2); font-size:12px; font-weight:750; line-height:1.45}

    details{
      margin-top: 12px;
      border:1px solid rgba(15,23,42,.10);
      border-radius:16px;
      padding:10px 12px;
      background: rgba(255,255,255,.85);
    }
    details summary{cursor:pointer; font-weight:1000; color:var(--muted)}

    .small{color:var(--muted2); font-weight:750; font-size:12px; line-height:1.55}
    .mono{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;}
    .hr{height:1px;background:rgba(15,23,42,.10);margin:12px 0}

    .errorTop{
      display:none;
      margin-top:12px;
      padding:12px 12px;
      border-radius:14px;
      border:1px solid rgba(244,63,94,.30);
      background: rgba(244,63,94,.08);
      color:#7a1020;
      font-weight:850;
      font-size:13px;
      white-space:pre-wrap;
    }

    footer{
      margin-top:16px;
      color:var(--muted2);
      font-weight:750;
      font-size:12px;
      text-align:center;
    }
  </style>
</head>

<body>
  <header class="topbar">
    <nav class="nav">
      <a class="brand" href="index.html" data-nav="1" aria-label="jobmejob Home">
        <span class="logo" aria-hidden="true"></span>
        <span>jobmejob</span>
      </a>

      <div class="navlinks" aria-label="App navigation">
        <a class="pill active" href="index.html" data-nav="1">Home</a>
        <a class="pill" href="profile.html" data-nav="1" title="Requires sign-in">Profile</a>
        <a class="pill" href="plan.html" data-nav="1" title="Requires sign-in">Plan</a>
        <a class="pill" href="jobs.html" data-nav="1" title="Requires sign-in">Jobs</a>
        <a class="pill" href="dashboard.html" data-nav="1" title="Requires sign-in">Dashboard</a>

        <a class="pill" id="navSignIn" href="signup.html" data-nav="1">Sign in</a>
        <button class="pill iconOnly" id="btnLogout" type="button" aria-label="Logout" style="display:none">Logout</button>
      </div>
    </nav>
  </header>

  <main class="main">
    <section class="hero">
      <div class="sectionTitle">
        <h1>Job search + CV tailoring, simplified.</h1>
        <span class="badge warn" id="topState">Checking…</span>
      </div>

      <p class="sub">
        Free: search jobs and tailor your CV per role. Paid: auto-apply that runs applications for you based on your plan.
      </p>

      <div class="errorTop" id="errorTop"></div>

      <div class="heroRow">
        <div class="card">
          <div class="sectionTitle">
            <div class="h2">Next step</div>
            <span class="badge" id="nextBadge">—</span>
          </div>

          <div class="small" id="nextHint">
            If you are new: sign in → upload CV → pick a plan → start applying.
          </div>

          <div class="actions">
            <button class="btn primary" id="btnPrimary" type="button">Loading…</button>
            <a class="btn" id="btnSecondary" href="signup.html" data-nav="1">Go to sign in</a>
          </div>

          <div class="hr"></div>

          <div class="small">
            We stay truthful: we never invent experience or certifications. We only rephrase and reorder based on your CV + profile.
          </div>

          <details>
            <summary>What does “ATS” mean?</summary>
            <div class="small" style="margin-top:8px">
              ATS = Applicant Tracking System. Many companies use software that scans CVs before a recruiter reads them.
              “ATS-safe” CVs use simple headings and clean structure so the text is easy to parse.
              <div style="height:8px"></div>
              Our ATS match score is an estimate of keyword coverage (used vs missing). It is not a guarantee of passing any employer’s system.
            </div>
          </details>
        </div>

        <aside class="card">
          <div class="sectionTitle">
            <div class="h2">Account</div>
            <span class="badge warn" id="acctBadge">—</span>
          </div>

          <div class="small">Signed in as</div>
          <div class="mono" id="acctEmail">—</div>

          <div class="hr"></div>

          <div class="small">Profile</div>
          <div class="badge" id="profileBadge">—</div>

          <div class="hr"></div>

          <div class="small">Plan</div>
          <div class="badge" id="planBadge">—</div>

          <div class="hr"></div>

          <div class="small">Queue (new jobs)</div>
          <div class="badge" id="queueBadge">—</div>

          <div class="hr"></div>

          <div class="actions">
            <a class="btn ghost" href="profile.html" data-nav="1">Edit profile</a>
            <a class="btn ghost" href="plan.html" data-nav="1">Change plan</a>
          </div>
        </aside>
      </div>
    </section>

    <section class="grid" aria-label="Workspace shortcuts">
      <div class="tile">
        <div class="tileTitle">Jobs</div>
        <div class="tileSub">Fetch and review your queue. Prioritize or skip jobs quickly.</div>
        <div class="tileFooter">
          <span class="badge good">Free</span>
          <a class="btn" href="jobs.html" data-nav="1">Open Jobs</a>
        </div>
      </div>

      <div class="tile">
        <div class="tileTitle">CV tailoring</div>
        <div class="tileSub">Tailor your CV to a specific job and keep ATS-safe formatting.</div>
        <div class="tileFooter">
          <span class="badge good">Free</span>
          <button class="btn" type="button" id="btnCvStudio" disabled title="Coming next">Coming next</button>
        </div>
      </div>

      <div class="tile">
        <div class="tileTitle">Auto-apply</div>
        <div class="tileSub">Start automated applications based on your plan and rules.</div>
        <div class="tileFooter">
          <span class="badge warn">Paid</span>
          <a class="btn" href="plan.html" data-nav="1">View plans</a>
        </div>
      </div>
    </section>

    <section class="card" style="margin-top:12px">
      <div class="sectionTitle">
        <div class="h2">How it works</div>
        <span class="badge" id="howBadge">Fast</span>
      </div>

      <div class="steps">
        <div class="step">
          <div class="num">1</div>
          <div>
            <div class="stepTitle">Sign in and set your profile</div>
            <div class="stepDesc">Upload your CV and define titles, location, and filters. We use this to focus the job search.</div>
          </div>
        </div>
        <div class="step">
          <div class="num">2</div>
          <div>
            <div class="stepTitle">Search jobs and tailor your CV</div>
            <div class="stepDesc">We extract keywords from job descriptions and adjust your CV wording (truthfully) to match the role.</div>
          </div>
        </div>
        <div class="step">
          <div class="num">3</div>
          <div>
            <div class="stepTitle">Auto-apply (paid)</div>
            <div class="stepDesc">When you start auto-apply, we run your daily quota based on your plan and keep a clear activity log.</div>
          </div>
        </div>
      </div>
    </section>

    <footer>
      <div>© <span id="year"></span> jobmejob</div>
      <div class="small">Need help? team@jobmejob.com</div>
    </footer>
  </main>

  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <script>
  "use strict";

  /* ============================================================
    Config (keep consistent with other multipage pages)
  ============================================================ */

  const SUPABASE_URL_DEFAULT = "https://awlzvhcnjegfhjedswko.supabase.co";
  const SUPABASE_ANON_FALLBACK = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImF3bHp2aGNuamVnZmhqZWRzd2tvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY2NTE2OTgsImV4cCI6MjA4MjIyNzY5OH0.-UmHiVi0_g9tKDkr6ldfROeBrOk8hm18YVPRfnb8luY";

  function safeGet(k){ try{ return localStorage.getItem(k); }catch(_){ return null; } }
  function safeSet(k,v){ try{ localStorage.setItem(k,v); }catch(_){ } }

  if(!safeGet("sb_url")) safeSet("sb_url", SUPABASE_URL_DEFAULT);
  if(!safeGet("sb_anon")) safeSet("sb_anon", SUPABASE_ANON_FALLBACK);

  const SUPABASE_URL = (safeGet("sb_url") || SUPABASE_URL_DEFAULT).trim() || SUPABASE_URL_DEFAULT;
  const SUPABASE_ANON_KEY = (safeGet("sb_anon") || SUPABASE_ANON_FALLBACK).trim() || SUPABASE_ANON_FALLBACK;

  const DEFAULT_API_BASE =
    (window.JobApplyAI && window.JobApplyAI.config && window.JobApplyAI.config.API_BASE)
      ? String(window.JobApplyAI.config.API_BASE).trim().replace(/\\/+$/, "")
      : "https://jobmejob.schoene-viktor.workers.dev";

  function readWorkplace(){
    const raw = safeGet("jobmejob_workplace") || safeGet("jobapplyai_workplace") || "";
    try{ return raw ? JSON.parse(raw) : {}; }catch(_){ return {}; }
  }
  const workplace = readWorkplace();
  const API_BASE = (workplace && workplace.apiBase) ? String(workplace.apiBase) : DEFAULT_API_BASE;

  const supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY, {
    auth: { persistSession: true, autoRefreshToken: true, detectSessionInUrl: true }
  });

  /* ============================================================
    Small helpers
  ============================================================ */

  function $(id){ return document.getElementById(id); }

  function go(url){
    document.body.classList.add("leaving");
    setTimeout(()=>{ window.location.href = url; }, 180);
  }
  document.addEventListener("click",(e)=>{
    const a = e.target.closest("a[data-nav='1']");
    if(!a) return;
    const url = a.getAttribute("href");
    if(!url || url.startsWith("#")) return;
    e.preventDefault();
    go(url);
  });

  function showError(msg){
    const el = $("errorTop");
    if(!el) return;
    if(!msg){
      el.style.display="none";
      el.textContent="";
      return;
    }
    el.style.display="block";
    el.textContent=String(msg);
  }

  function setBadge(id, text, kind){
    const el = $(id);
    if(!el) return;
    el.textContent = text || "—";
    el.className = "badge " + (kind || "");
  }

  async function getSession(){
    const { data, error } = await supabaseClient.auth.getSession();
    if(error) return null;
    return data && data.session ? data.session : null;
  }

  async function apiGet(path, token){
    const res = await fetch(API_BASE + path, { headers: { Authorization: "Bearer " + token }});
    const txt = await res.text().catch(()=> "");
    if(!res.ok) throw new Error(path + " failed: " + res.status + " " + txt);
    try{ return txt ? JSON.parse(txt) : null; }catch(_){ return { raw: txt }; }
  }

  async function logout(){
    try{ await supabaseClient.auth.signOut(); }catch(_){}
    // Clear app keys (keep sb_url/sb_anon)
    try{
      const keys=[];
      for(let i=0;i<localStorage.length;i++){
        const k = localStorage.key(i);
        if(k) keys.push(k);
      }
      for(const k of keys){
        if(
          k.startsWith("jm_") || k.startsWith("ja_") ||
          k.startsWith("jobmejob_") || k.startsWith("jobapplyai_") ||
          k.startsWith("tailor_")
        ){
          try{ localStorage.removeItem(k); }catch(_){}
        }
      }
    }catch(_){}
    try{ sessionStorage.removeItem("sb_access_token"); }catch(_){}
    go("./index.html");
  }

  function nextStepFromState(state){
    if(!state) return "./dashboard.html";
    const profileComplete = !!state.profile_complete;
    const planId = state.plan_id ? String(state.plan_id) : "";
    if(!profileComplete) return "./profile.html";
    if(!planId) return "./plan.html";
    return "./dashboard.html";
  }

  async function refreshUi(){
    showError("");
    const year = new Date().getFullYear();
    const y = $("year"); if(y) y.textContent = String(year);

    setBadge("topState", "Checking…", "warn");
    setBadge("acctBadge", "—", "warn");
    setBadge("profileBadge", "—", "");
    setBadge("planBadge", "—", "");
    setBadge("queueBadge", "—", "");

    const btnPrimary = $("btnPrimary");
    const btnSecondary = $("btnSecondary");
    const navSignIn = $("navSignIn");
    const btnLogout = $("btnLogout");

    if(btnPrimary){
      btnPrimary.disabled = true;
      btnPrimary.textContent = "Loading…";
    }

    const session = await getSession();
    if(!session || !session.access_token){
      // Signed out
      setBadge("topState", "Not signed in", "warn");
      setBadge("acctBadge", "Signed out", "warn");
      $("acctEmail").textContent = "—";

      if(btnLogout) btnLogout.style.display="none";
      if(navSignIn) navSignIn.style.display="inline-flex";

      setBadge("nextBadge", "Start", "warn");
      $("nextHint").textContent = "Sign in with Google to create your workspace.";

      if(btnPrimary){
        btnPrimary.disabled = false;
        btnPrimary.textContent = "Get started";
        btnPrimary.onclick = ()=> go("./signup.html");
      }
      if(btnSecondary){
        btnSecondary.textContent = "See plans";
        btnSecondary.setAttribute("href","plan.html");
      }
      return;
    }

    // Signed in
    try{ sessionStorage.setItem("sb_access_token", session.access_token); }catch(_){}
    const email = (session.user && session.user.email) ? String(session.user.email) : "—";

    setBadge("topState", "Signed in", "good");
    setBadge("acctBadge", "Signed in", "good");
    $("acctEmail").textContent = email;

    if(navSignIn) navSignIn.style.display="none";
    if(btnLogout){
      btnLogout.style.display="inline-flex";
      btnLogout.onclick = logout;
    }

    // Load state + queue count (best effort, non-blocking)
    let state = null;
    try{
      state = await apiGet("/me/state", session.access_token);
    }catch(e){
      // keep going; show minimal info
      console.warn(e);
    }

    if(state){
      if(state.profile_complete){
        setBadge("profileBadge", "Complete", "good");
      }else{
        setBadge("profileBadge", "Needs setup", "warn");
      }

      if(state.plan_id){
        setBadge("planBadge", "Active (" + String(state.plan_id) + ")", "good");
      }else{
        setBadge("planBadge", "Select a plan", "warn");
      }
    }else{
      setBadge("profileBadge", "Unknown", "warn");
      setBadge("planBadge", "Unknown", "warn");
    }

    try{
      const q = await apiGet("/me/jobs/queue", session.access_token);
      const cnt = (q && typeof q.queue_new_count === "number") ? q.queue_new_count :
                  (q && Array.isArray(q.jobs)) ? q.jobs.length : "—";
      setBadge("queueBadge", String(cnt), "good");
    }catch(_){
      setBadge("queueBadge", "—", "");
    }

    const nextUrl = nextStepFromState(state);
    setBadge("nextBadge", nextUrl.includes("profile") ? "Profile setup" :
                          nextUrl.includes("plan") ? "Pick plan" :
                          "Dashboard", "good");

    $("nextHint").textContent = nextUrl.includes("profile")
      ? "Your profile is not complete yet. Upload your CV and set preferences."
      : nextUrl.includes("plan")
        ? "Pick a plan to enable auto-apply. (Jobs + CV tailoring remain free.)"
        : "You are set up. Open your dashboard to manage the pipeline.";

    if(btnPrimary){
      btnPrimary.disabled = false;
      btnPrimary.textContent = "Continue";
      btnPrimary.onclick = ()=> go(nextUrl);
    }
    if(btnSecondary){
      btnSecondary.textContent = "Open Jobs";
      btnSecondary.setAttribute("href","jobs.html");
    }
  }

  // Boot + keep in sync after OAuth redirect
  supabaseClient.auth.onAuthStateChange(()=>{ refreshUi().catch(()=>{}); });

  refreshUi().catch(e=>{
    console.error(e);
    showError(e && e.message ? e.message : String(e));
    setBadge("topState", "Error", "bad");
  });

  </script>
</body>
</html>
