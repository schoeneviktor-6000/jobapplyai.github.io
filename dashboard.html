<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>JobApply-AI | Dashboard</title>
<style>
:root{
--bg:#ffffff;
--surface:#f6f7f8;
--text:#0b0b0b;
--muted:#4a4a4a;
--muted2:#6c6c6c;
--border:#d7dadc;
--shadow:0 12px 30px rgba(0,0,0,.08);
--shadow2:0 14px 36px rgba(0,0,0,.22);
--green:#00a63f;
--green2:#00c853;
--amber:#ffb000;
--red:#d92d20;
--radius:22px;
--grad:linear-gradient(135deg,var(--green),var(--green2));
--max:1120px;
--safeTop: env(safe-area-inset-top, 0px);
--safeBottom: env(safe-area-inset-bottom, 0px);
}
*{box-sizing:border-box}
html,body{height:100%}
body{
margin:0;
font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
color:var(--text);
background:
radial-gradient(1100px 600px at 8% 0%, rgba(0,166,63,.12), transparent 60%),
radial-gradient(900px 520px at 92% 6%, rgba(0,200,83,.10), transparent 55%),
var(--bg);
}
a{color:inherit}
.topbar{
position:sticky;
top:0;
z-index:20;
backdrop-filter:saturate(1.4) blur(10px);
background:rgba(255,255,255,.72);
border-bottom:1px solid rgba(215,218,220,.7);
padding-top:var(--safeTop);
}
.nav{
max-width:var(--max);
margin:0 auto;
padding:12px 16px;
display:flex;
align-items:center;
justify-content:space-between;
gap:12px;
}
.brand{
display:flex;
align-items:center;
gap:10px;
font-weight:950;
letter-spacing:.2px;
text-decoration:none;
min-width:0;
}
.brand span:last-child{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.logo{
width:34px;
height:34px;
border-radius:12px;
background:var(--grad);
box-shadow:0 10px 24px rgba(0,166,63,.22);
flex:0 0 auto;
}
.navlinks{
display:flex;
align-items:center;
gap:10px;
flex-wrap:wrap;
justify-content:flex-end;
}
.pill{
display:inline-flex;
align-items:center;
gap:8px;
padding:9px 12px;
border-radius:999px;
border:1px solid rgba(215,218,220,.9);
background:rgba(246,247,248,.92);
font-weight:800;
font-size:13px;
text-decoration:none;
transition:transform .12s ease, box-shadow .18s ease, border-color .15s ease, background .15s ease;
cursor:pointer;
white-space:nowrap;
}
.pill:hover{transform:translateY(-1px);box-shadow:var(--shadow);border-color:rgba(0,166,63,.22)}
.pill.primary{border-color:transparent;background:var(--text);color:#fff}
.pill.primary:hover{transform:translateY(-1px);box-shadow:var(--shadow2)}
.pill.iconOnly{padding:9px 10px}

.main{
max-width:var(--max);
margin:0 auto;
padding:18px 16px calc(18px + var(--safeBottom));
}
.h1{
font-size:38px;
line-height:1.05;
letter-spacing:-1px;
margin:10px 0 8px 0;
}
.sub{margin:0 0 14px 0;color:var(--muted);font-weight:650}

.card{
background:rgba(255,255,255,.92);
border:1px solid rgba(215,218,220,.85);
border-radius:var(--radius);
box-shadow:var(--shadow);
padding:14px;
}
.card h2{
margin:0 0 10px 0;
font-size:16px;
display:flex;
align-items:center;
justify-content:space-between;
gap:10px;
}
.kpi{
display:flex;
align-items:flex-end;
justify-content:space-between;
gap:10px;
}
.kpi .value{
font-size:34px;
font-weight:950;
letter-spacing:-.6px;
line-height:1;
}
.kpi .label{
color:var(--muted2);
font-weight:700;
font-size:12px;
}
.badge{
display:inline-flex;
align-items:center;
gap:8px;
padding:8px 12px;
border-radius:14px;
border:1px solid rgba(215,218,220,.9);
background:rgba(246,247,248,.92);
font-weight:850;
font-size:13px;
color:var(--muted);
white-space:nowrap;
}
.badge.good{border-color:rgba(0,166,63,.25);color:#075b24}
.badge.warn{border-color:rgba(255,176,0,.35);color:#7a4d00}
.badge.bad{border-color:rgba(217,45,32,.35);color:#7a1a12}
.hr{height:1px;background:rgba(215,218,220,.8);margin:12px 0}
.actions{
display:flex;
gap:10px;
flex-wrap:wrap;
align-items:center;
}
.btn{
appearance:none;
border:0;
cursor:pointer;
padding:10px 12px;
border-radius:999px;
font-weight:900;
font-size:13px;
letter-spacing:.2px;
display:inline-flex;
align-items:center;
gap:8px;
transition:transform .12s ease, box-shadow .18s ease, opacity .15s ease;
text-decoration:none;
}
.btn:disabled{cursor:not-allowed;opacity:.55}
.btn.primary{background:var(--grad);color:#fff;box-shadow:0 14px 34px rgba(0,166,63,.20)}
.btn.primary:hover{transform:translateY(-1px);box-shadow:0 18px 40px rgba(0,166,63,.25)}
.btn.ghost{background:var(--text);color:#fff}
.btn.ghost:hover{transform:translateY(-1px);box-shadow:var(--shadow2)}
.btn.light{border:1px solid rgba(215,218,220,.95);background:rgba(246,247,248,.92);color:var(--text)}
.btn.light:hover{transform:translateY(-1px);box-shadow:var(--shadow)}

.tableWrap{
overflow:auto;
-webkit-overflow-scrolling:touch;
border-radius:16px;
border:1px solid rgba(215,218,220,.9);
background:rgba(255,255,255,.92);
}
.table{
width:100%;
min-width:640px;
border-collapse:separate;
border-spacing:0;
}
.table th,.table td{
text-align:left;
padding:10px 10px;
font-size:13px;
border-bottom:1px solid rgba(215,218,220,.7);
vertical-align:top;
}
.table th{background:rgba(246,247,248,.92);font-weight:950}
.table tr:last-child td{border-bottom:0}
.small{font-size:12px;color:var(--muted2);font-weight:650}
.footer{
max-width:var(--max);
margin:0 auto;
padding:18px 16px 30px;
color:var(--muted2);
font-size:13px;
}
.mono{
font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;
font-size:12px;
word-break:break-all;
}

.healthTop{
background:
radial-gradient(900px 380px at 0% 0%, rgba(0,166,63,.13), transparent 55%),
radial-gradient(800px 340px at 100% 0%, rgba(0,200,83,.10), transparent 60%),
rgba(255,255,255,.92);
}
.healthRow{
display:flex;
align-items:center;
justify-content:space-between;
gap:10px;
flex-wrap:wrap;
}
.meter{
width:100%;
height:10px;
border-radius:999px;
border:1px solid rgba(215,218,220,.9);
background:rgba(246,247,248,.92);
overflow:hidden;
margin-top:10px;
}
.meter > div{
height:100%;
width:0%;
background:var(--grad);
border-radius:999px;
transition:width .25s ease;
}
.healthNote{margin-top:10px}
.healthNote .mono{white-space:normal;word-break:break-word}
.error{
margin-top:10px;
padding:10px 12px;
border-radius:14px;
border:1px solid rgba(217,45,32,.25);
background:rgba(217,45,32,.06);
color:#7a1a12;
font-weight:750;
font-size:13px;
}
.errorTop{
margin:12px 0 12px 0;
padding:12px 14px;
border-radius:16px;
border:1px solid rgba(217,45,32,.25);
background:rgba(217,45,32,.06);
color:#7a1a12;
font-weight:800;
display:none;
}

/* Desktop-first grid */
.cards{
display:grid;
gap:14px;
margin:12px 0 16px 0;
grid-template-columns:repeat(12, minmax(0,1fr));
}
.cards > .card:nth-child(1){grid-column:span 4;}
.cards > .card:nth-child(2){grid-column:span 2;}
.cards > .card:nth-child(3){grid-column:span 2;}
.cards > .card:nth-child(4){grid-column:span 4;}

.grid{
display:grid;
grid-template-columns:repeat(12, minmax(0,1fr));
gap:16px;
align-items:start;
}
.grid > section.card{grid-column:span 8;}
.grid > aside.card{grid-column:span 4;position:sticky;top:88px;}

@media (max-width:1100px){
.cards{grid-template-columns:repeat(2, 1fr)}
.cards > .card:nth-child(1),
.cards > .card:nth-child(2),
.cards > .card:nth-child(3),
.cards > .card:nth-child(4){grid-column:auto}
.grid{grid-template-columns:1fr}
.grid > section.card{grid-column:auto}
.grid > aside.card{grid-column:auto;position:static}
}
@media (max-width:620px){
.nav{padding:10px 12px}
.main{padding:16px 12px calc(16px + var(--safeBottom))}
.h1{font-size:32px}
.actions{flex-direction:column;align-items:stretch}
.btn{justify-content:center;width:100%}
.cards{grid-template-columns:1fr}
}

/* Animations + skeleton */
@keyframes cardIn{
from{opacity:0;transform:translateY(10px)}
to{opacity:1;transform:translateY(0)}
}
.card{animation:cardIn .22s ease-out both}
.cards .card:nth-child(1){animation-delay:.02s}
.cards .card:nth-child(2){animation-delay:.05s}
.cards .card:nth-child(3){animation-delay:.08s}
.cards .card:nth-child(4){animation-delay:.11s}
.grid .card{animation-delay:.14s}

@keyframes shimmer{
0%{background-position:200% 0}
100%{background-position:-200% 0}
}
.skeleton{
border-radius:12px;
height:12px;
background:linear-gradient(90deg, rgba(0,0,0,.06), rgba(0,0,0,.02), rgba(0,0,0,.06));
background-size:200% 100%;
animation:shimmer 1.2s linear infinite;
}
.skeleton.big{height:32px;border-radius:14px}
.skeleton.row{height:14px}
.skeleton.block{height:140px;border-radius:16px}

@media (prefers-reduced-motion: reduce){
.card{animation:none}
.skeleton{animation:none}
.btn,.pill{transition:none}
.meter > div{transition:none}
}
</style>
</head>
<body>

<header class="topbar">
<nav class="nav">
<a class="brand" href="index.html"><span class="logo" aria-hidden="true"></span><span>JobApply-AI</span></a>
<div class="navlinks">
<a class="pill" href="index.html">Home</a>
<a class="pill" href="profile.html">Profile</a>
<a class="pill" href="plan.html">Plan</a>
<a class="pill primary" href="dashboard.html">Dashboard</a>
<button class="pill iconOnly" id="btnLogout" type="button" aria-label="Logout">Logout</button>
</div>
</nav>
</header>

<main class="main">
<h1 class="h1">Dashboard</h1>
<p class="sub" id="subLine">Loading…</p>
<div class="errorTop" id="errorTop"></div>

<div class="cards">
<div class="card healthTop">
<h2>Health status <span class="badge" id="badgeHealth">Loading</span></h2>
<div class="healthRow">
<div class="kpi">
<div>
<div class="value" id="kpiHealthLabel">–</div>
<div class="label">job supply vs your plan</div>
</div>
</div>
<div style="display:flex;gap:8px;flex-wrap:wrap;justify-content:flex-end">
<span class="badge" id="badgeHealthPlan">Plan: –</span>
<span class="badge" id="badgeHealthQueue">Queue: –</span>
<span class="badge" id="badgeHealthCap">Today cap: –</span>
</div>
</div>
<div class="meter" aria-hidden="true"><div id="healthMeterFill"></div></div>
<div class="healthNote" id="healthNote"></div>
</div>

<div class="card">
<h2>Job queue</h2>
<div class="kpi">
<div>
<div class="value" id="kpiQueue">–</div>
<div class="label">jobs ready to apply</div>
</div>
<span class="badge" id="badgeQueue">Loading</span>
</div>
</div>

<div class="card">
<h2>Applications</h2>
<div class="kpi">
<div>
<div class="value" id="kpiAppsTotal">–</div>
<div class="label">total applications</div>
</div>
<span class="badge" id="badgeApps">Loading</span>
</div>
</div>

<div class="card">
<h2>Plan</h2>
<div class="kpi">
<div>
<div class="value" id="kpiPlanName">–</div>
<div class="label" id="kpiPlanMeta">selected plan</div>
</div>
<span class="badge" id="badgePlan">Loading</span>
</div>
</div>
</div>

<div class="grid">
<section class="card">
<h2>Queue preview</h2>
<p class="small">Top 15 items from /me/jobs/queue. On mobile, swipe the table left/right if needed.</p>
<div class="actions">
<button class="btn primary" id="btnRefresh" type="button">Refresh</button>
<button class="btn light" id="btnCopyToken" type="button">Copy access token</button>
</div>
<div class="hr"></div>
<div id="queueWrap"><div class="skeleton block"></div></div>
<div id="queueError"></div>
</section>

<aside class="card">
<h2>Account</h2>
<div class="badge good" id="badgeUser">Signed in</div>
<div class="hr"></div>

<div class="small">Email</div>
<div class="mono" id="meEmail">–</div>

<div class="hr"></div>
<div class="small">Customer ID</div>
<div class="mono" id="meCustomerId">–</div>

<div class="hr"></div>
<div class="small">Applications breakdown</div>
<div id="appsBreakdown"><div class="skeleton row" style="width:80%"></div><div style="height:8px"></div><div class="skeleton row" style="width:60%"></div></div>

<div class="hr"></div>
<div class="small">Last refresh</div>
<div class="mono" id="lastCheck">–</div>

<div class="hr"></div>
<div class="actions">
<a class="btn ghost" href="profile.html">Edit profile</a>
<a class="btn ghost" href="plan.html">Change plan</a>
</div>

<div class="hr"></div>
<div class="small" id="errorBox"></div>
</aside>
</div>
</main>

<footer class="footer">Support: <a href="mailto:schonv2@gmail.com">schonv2@gmail.com</a></footer>

<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<script>
const API_BASE="https://jobapplyai-api.schoene-viktor.workers.dev";
const SUPABASE_URL="https://awlzvhcnjegfhjedswko.supabase.co";
const SUPABASE_ANON_KEY="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImF3bHp2aGNuamVnZmhqZWRzd2tvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY2NTE2OTgsImV4cCI6MjA4MjIyNzY5OH0.-UmHiVi0_g9tKDkr6ldfROeBrOk8hm18YVPRfnb8luY";
let supabaseClient=null;

function setText(id,text){
const el=document.getElementById(id);
if(el) el.textContent=text;
}
function setHtml(id,html){
const el=document.getElementById(id);
if(el) el.innerHTML=html;
}
function setBadge(id,type,text){
const el=document.getElementById(id);
if(!el) return;
el.className="badge"+(type?(" "+type):"");
el.textContent=text;
}
function showTopError(msg){
const el=document.getElementById("errorTop");
if(!el) return;
el.style.display="block";
el.textContent=msg;
}
function clearTopError(){
const el=document.getElementById("errorTop");
if(!el) return;
el.style.display="none";
el.textContent="";
}
function escapeHtml(s){
return String(s??"").replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;");
}
function nowStamp(){
return new Date().toISOString().replace("T"," ").replace("Z"," UTC");
}

function animateNumber(el,to){
if(!el) return;
const prefersReduced=window.matchMedia&&window.matchMedia("(prefers-reduced-motion: reduce)").matches;
if(prefersReduced){el.textContent=String(to);return;}
const from=Number(String(el.textContent||"").replace(/[^\d.-]/g,""))||0;
const start=performance.now();
const dur=420;
function tick(t){
const p=Math.min(1,(t-start)/dur);
const eased=1-Math.pow(1-p,3);
const v=Math.round(from+(to-from)*eased);
el.textContent=String(v);
if(p<1) requestAnimationFrame(tick);
}
requestAnimationFrame(tick);
}

function renderQueueSkeleton(){
return '<div class="skeleton big" style="width:220px"></div><div style="height:10px"></div><div class="skeleton row" style="width:96%"></div><div style="height:8px"></div><div class="skeleton row" style="width:92%"></div><div style="height:8px"></div><div class="skeleton row" style="width:88%"></div><div style="height:8px"></div><div class="skeleton row" style="width:84%"></div>';
}

function getPlanDaily(){
const raw=(localStorage.getItem("ja_plan")||"").trim();
const n=Number(raw);
if([1,5,10].includes(n)) return n;
return 0;
}
function planInfo(planDaily){
if(planDaily===1) return {name:"Starter",meta:"1 application/day",short:"Starter (1/day)"};
if(planDaily===5) return {name:"Plus",meta:"5 applications/day",short:"Plus (5/day)"};
if(planDaily===10) return {name:"Pro",meta:"10 applications/day",short:"Pro (10/day)"};
return {name:"No plan",meta:"Select Starter / Plus / Pro",short:"No plan"};
}

async function requireSession(){
if(!supabaseClient) throw new Error("Supabase client not initialized.");
const {data,error}=await supabaseClient.auth.getSession();
if(error) throw error;
if(!data||!data.session){
window.location.replace("./signup.html");
return null;
}
return data.session;
}

async function apiGet(path,accessToken){
const res=await fetch(API_BASE+path,{method:"GET",headers:{"Authorization":"Bearer "+accessToken}});
const text=await res.text().catch(()=> "");
let json=null;
try{json=JSON.parse(text);}catch{json={raw:text};}
if(!res.ok){
const msg=(json&&(json.error||json.details))?(json.error||json.details):text;
throw new Error(path+" failed: "+res.status+" "+msg);
}
return json;
}

function renderQueueTable(queue){
const items=Array.isArray(queue?.data)?queue.data:[];
if(items.length===0) return '<span class="badge warn">No jobs in queue</span>';
const rows=items.slice(0,15).map(j=>{
const title=j.title||"Untitled";
const company=j.company_name||"—";
const city=j.city||"—";
const country=j.country||"—";
const posted=j.posted_at?String(j.posted_at).slice(0,10):"—";
const link=j.apply_url?String(j.apply_url):"";
const titleCell=link?('<a href="'+escapeHtml(link)+'" target="_blank" rel="noopener">'+escapeHtml(title)+'</a>'):escapeHtml(title);
return "<tr><td>"+titleCell+"</td><td>"+escapeHtml(company)+"</td><td>"+escapeHtml(city)+"</td><td>"+escapeHtml(country)+"</td><td>"+escapeHtml(posted)+"</td></tr>";
}).join("");
return '<div class="tableWrap"><table class="table"><thead><tr><th>Title</th><th>Company</th><th>City</th><th>Country</th><th>Posted</th></tr></thead><tbody>'+rows+'</tbody></table></div><div class="small" style="margin-top:10px">Showing '+Math.min(items.length,15)+' of '+items.length+' jobs</div>';
}

function renderAppsBreakdown(summary){
const counts=summary&&summary.counts?summary.counts:null;
if(!counts||typeof counts!=="object") return '<span class="badge warn">Not available</span>';
const entries=Object.entries(counts);
if(entries.length===0) return '<span class="badge warn">No applications yet</span>';
entries.sort((a,b)=>String(a[0]).localeCompare(String(b[0])));
const rows=entries.map(([k,v])=>"<tr><td>"+escapeHtml(k)+"</td><td>"+escapeHtml(v)+"</td></tr>").join("");
return '<div class="tableWrap"><table class="table" style="min-width:320px"><thead><tr><th>Status</th><th>Count</th></tr></thead><tbody>'+rows+'</tbody></table></div>';
}

function computeSupply(queueCount,planDaily){
let healthLabel="Low";
let badgeType="warn";
let cap=1;
if(queueCount>=25){healthLabel="Healthy";badgeType="good";cap=10;}
else if(queueCount>=5){healthLabel="Medium";badgeType="";cap=5;}
let note="";
if(!planDaily) note="Select a plan to start. Without a plan, the system does not know your daily target.";
else if(queueCount===0) note="No jobs in your queue yet. Use Workplace to fetch jobs, or broaden your titles/radius.";
else if(queueCount<planDaily) note="Your queue is below your plan. Add more desired titles and/or increase radius to avoid running out of applications.";
else note="You have enough supply for today.";
let ratio=0;
if(planDaily&&planDaily>0) ratio=Math.min(1,queueCount/(planDaily*5));
else ratio=Math.min(1,queueCount/10);
return {healthLabel,badgeType,cap,note,ratio};
}

function renderHealthTop(queueCount,planDaily){
const p=planInfo(planDaily);
const s=computeSupply(queueCount,planDaily);
setBadge("badgeHealth",s.badgeType,s.healthLabel);
setText("kpiHealthLabel",s.healthLabel);
setBadge("badgeHealthPlan",planDaily?"":"warn","Plan: "+p.short);
setBadge("badgeHealthQueue",queueCount>0?"good":"warn","Queue: "+queueCount);
setBadge("badgeHealthCap","","Today cap: "+s.cap+"/day");
const meter=document.getElementById("healthMeterFill");
if(meter) meter.style.width=Math.round(s.ratio*100)+"%";
setHtml("healthNote",'<div class="mono">Recommended cap based on supply: '+s.cap+'/day</div><div class="mono" style="margin-top:6px">'+escapeHtml(s.note)+'</div>');
}

async function loadDashboard(){
clearTopError();
setText("errorBox","");
setHtml("queueError","");
setText("lastCheck",nowStamp());
setBadge("badgeQueue","","Loading");
setBadge("badgeApps","","Loading");
setBadge("badgePlan","","Loading");
setBadge("badgeHealth","","Loading");
setHtml("queueWrap",renderQueueSkeleton());
setHtml("appsBreakdown",'<div class="skeleton row" style="width:80%"></div><div style="height:8px"></div><div class="skeleton row" style="width:60%"></div>');

const session=await requireSession();
if(!session) return;

const email=session.user&&session.user.email?session.user.email:"—";
setText("meEmail",email);
setText("subLine","Signed in as "+email);

const planDaily=getPlanDaily();
const p=planInfo(planDaily);
setText("kpiPlanName",p.name);
setText("kpiPlanMeta",planDaily?p.meta:"no plan selected");
setBadge("badgePlan",planDaily?"good":"warn",planDaily?"Selected":"Not selected");

try{
const queue=await apiGet("/me/jobs/queue",session.access_token);
setText("meCustomerId",queue&&queue.customer_id?queue.customer_id:"—");
const qCount=(typeof queue.count==="number")?queue.count:(Array.isArray(queue.data)?queue.data.length:0);
animateNumber(document.getElementById("kpiQueue"),qCount);
setBadge("badgeQueue",qCount>0?"good":"warn",qCount>0?"OK":"Empty");
setHtml("queueWrap",renderQueueTable(queue));
renderHealthTop(qCount,planDaily);
}catch(e){
setText("kpiQueue","–");
setBadge("badgeQueue","bad","Error");
setBadge("badgeHealth","bad","Error");
setHtml("queueWrap",'<span class="badge bad">Queue failed</span>');
setHtml("queueError",'<div class="error">'+escapeHtml(e.message)+'</div>');
setText("errorBox",e.message);
showTopError(e.message);
}

try{
const apps=await apiGet("/me/applications/summary",session.access_token);
const total=(typeof apps.total==="number")?apps.total:0;
animateNumber(document.getElementById("kpiAppsTotal"),total);
setBadge("badgeApps","good","OK");
setHtml("appsBreakdown",renderAppsBreakdown(apps));
}catch(e){
setText("kpiAppsTotal","–");
setBadge("badgeApps","warn","Not ready");
setHtml("appsBreakdown",'<span class="badge warn">Endpoint not available</span>');
}
}

function wireEvents(){
document.getElementById("btnRefresh").addEventListener("click",async()=>{try{await loadDashboard();}catch(e){showTopError(e.message);setText("errorBox",e.message);}});
document.getElementById("btnCopyToken").addEventListener("click",async()=>{
try{
const {data}=await supabaseClient.auth.getSession();
const token=data&&data.session?data.session.access_token:"";
if(!token){alert("No session token found. Please sign in again.");return;}
await navigator.clipboard.writeText(token);
alert("Access token copied.");
}catch(e){showTopError(e.message);}
});
document.getElementById("btnLogout").addEventListener("click",async()=>{
try{
await supabaseClient.auth.signOut();
window.location.replace("./index.html");
}catch(e){showTopError(e.message);}
});
}

window.addEventListener("load",async()=>{
try{
if(!window.supabase) throw new Error("Supabase library did not load. Check adblockers / network / CSP.");
supabaseClient=window.supabase.createClient(SUPABASE_URL,SUPABASE_ANON_KEY);
wireEvents();
await loadDashboard();
}catch(e){
showTopError(e.message);
setText("errorBox",e.message);
setBadge("badgeQueue","bad","Error");
setBadge("badgeApps","bad","Error");
setBadge("badgePlan","bad","Error");
setBadge("badgeHealth","bad","Error");
}
});
</script>

</body>
</html>
